---
title             : "A benchmark dataset for detecting frames in multi-topical news content: Online Appendix"
output:
 papaja::apa6_pdf:
   latex_engine: xelatex
---

```{r setup, include = FALSE}
library(parameters)
print2 <- function(x, y, r2 = TRUE) {
    cat("## ", x, "\n")
    suppressWarnings(print(print_md(parameters(y, ci = 0.89))))
    if (r2) {
        cat("$R^2$ = ", brms::bayes_R2(y)[1] , "\n\n")
    }
}
require(brms)
require(ggplot2)
require(tidyverse)
require(cowplot)
```


## Comparing confidence level of correct and incorrect expert coding

We modeled the correctness of expert coding ("F1" is equal to the ground truth) and confidence level ("F2"), while adjusting for individual differences between the two experts using Bayesian multilevel logistic regression analysis. The following is the robust conditional effect plot. There is no evidence to suggest that there is a trend. Therefore, experts can either confidently give correct and incorrect coding.

```{r brms, fig.cap = "Robust conditional effects from the Bayesian model on the relationship between correction rate of expert coding and confidence at 89% credibility"}
mod <- readRDS(here::here("intermediate/conf_mod.RDS"))
plot(conditional_effects(mod, prob = 0.89, plot = FALSE), plot = FALSE) [[1]] +  xlab("Confidence") + ylab("Correction rate") + theme_minimal()
```

## Regression coefficients

```{r, results = "asis", echo = FALSE}
print2("", readRDS(here::here("intermediate", "brms_mod.RDS")))
```

## Simulation of increasing sample size

### LDA

```{r}
ireadRDS <- function(fname) {
    readRDS(here::here("intermediate", fname))
}

plotn_lda <- function(n) {
    ireadRDS(paste0("LDA_sim", n, ".RDS")) %>% mutate(maxp = map_dbl(res, max)) %>% rowwise() %>% mutate(desc = paste0(words, ifelse(stopwords, ", sw", ""), ifelse(trim, ", s/d", ""), ", Alpha: ", alpha), se = sqrt((maxp * (1 - maxp)) / n), upper = maxp + (1.59 * se), lower = maxp - (1.59 * se), method = "LDA") -> ldax
    return(data.frame(x = seq(1, nrow(ldax)), n = n, maxp = sort(ldax$maxp)))
}

purrr::map_dfr(c(300, 500, 1000, 3000), plotn_lda) %>% mutate(n = factor(n, levels = c(300, 500, 1000, 3000))) %>% ggplot(aes(x = maxp, y = x, group = n, color = n)) + geom_line() + geom_vline(aes(xintercept = 0.2, alpha = 0.5), linetype = "dashed") + geom_vline(aes(xintercept = 0.3, alpha = 0.5), linetype = "dashed") + xlab(expression(CCR[max])) + xlim(0, 0.6) + ylab("Treatment") + theme_minimal()


##plot_grid(all_plots[[1]], all_plots[[2]], all_plots[[3]], all_plots[[4]], labels = c('300', '500', "1000", "3000"), ncol = 1)

```

### Seeded-LDA

```{r}
plotn_seeded <- function(n) {
    ireadRDS(paste0("SEEDEDLDA_sim", n, ".RDS")) %>% mutate(maxp = map_dbl(res, max)) %>% rowwise() %>% mutate(desc = paste0(words, ifelse(stopwords, ", sw", ""), ifelse(trim, ", s/d", ""), ", alpha: ", alpha, ", exp", expert), se = sqrt((maxp * (1 - maxp)) / n), upper = maxp + (1.59 * se), lower = maxp - (1.59 * se), method = "LDA") -> seededx
    return(data.frame(x = seq(1, nrow(seededx)), n = n, maxp = sort(seededx$maxp)))
}
purrr::map_dfr(c(300, 500, 1000, 3000), plotn_seeded) %>% mutate(n = factor(n, levels = c(300, 500, 1000, 3000))) %>% ggplot(aes(x = maxp, y = x, group = n, color = n)) + geom_line() + geom_vline(aes(xintercept = 0.2), alpha = 0.5, linetype = "dashed") + geom_vline(aes(xintercept = 0.3), alpha = 0.5, linetype = "dashed") + xlab(expression(CCR[max])) + xlim(0, 0.6) + ylab("Treatment") + theme_minimal()
```
